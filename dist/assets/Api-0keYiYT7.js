var d=Object.defineProperty;var f=(o,s,e)=>s in o?d(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e;var h=(o,s,e)=>f(o,typeof s!="symbol"?s+"":s,e);import{u as g,aX as v,aY as p,ad as m}from"./index-CvL64b5B.js";class c extends Error{constructor(e,t=null,a=null){super(e);h(this,"code");h(this,"errors");this.code=a,this.errors=t}}const w=()=>({fetch:(s,e={})=>{const{apiBaseUrl:t,storagePrefix:a}=m(),n=g();return v(`${t}/${s}`,{beforeFetch:({options:r})=>(r.headers={Accept:"application/json",Authorization:`Bearer ${n.token}`,...r.headers,Locale:localStorage.getItem(`${a}lang`)},{options:{...r,...e}}),updateDataOnError:!0,onFetchError(r){var u,i,l;if(r.error){if(((u=r.response)==null?void 0:u.status)===401)return n.logout(),setTimeout(()=>p.push({name:"auth.login"})),r;if(((i=r.response)==null?void 0:i.status)===500)return p.push({name:"500"}),r;r.data&&r.data.message&&(r.error=new c(r.data.message,r.data.errors,(l=r.response)==null?void 0:l.status))}return r}})}}),{fetch:$}=w();class R{constructor(){h(this,"fetch",$);h(this,"resource","")}async get(s={}){var u;let e=this.resource;const t=new URLSearchParams(s).toString();Object.keys(s).length&&(e+=`?${t}`);const{data:a,error:n,response:r}=await this.fetch(e).json();return this.handleResponse(a.value,n.value,(u=r.value)==null?void 0:u.status)}async paginate(s={}){const e={...s,paginate:!0};try{return await this.get(e)}catch(t){const a=t;throw new c(a.message,a.errors)}}async show(s){var n;const{data:e,error:t,response:a}=await this.fetch(`${this.resource}/${s}`).json();return this.handleResponse(e.value,t.value,(n=a.value)==null?void 0:n.status)}async store(s={}){var n;const{data:e,error:t,response:a}=await this.fetch(this.resource).post(s).json();return this.handleResponse(e.value,t.value,(n=a.value)==null?void 0:n.status)}async update(s,e={}){var r;const{data:t,error:a,response:n}=await this.fetch(`${this.resource}/${s}`).put(e).json();return this.handleResponse(t.value,a.value,(r=n.value)==null?void 0:r.status)}async destroy(s){var n;const{data:e,error:t,response:a}=await this.fetch(`${this.resource}/${s}`).delete().json();return this.handleResponse(e.value,t.value,(n=a.value)==null?void 0:n.status)}handleResponse(s,e,t){if(e!=null&&e.message)throw new c(e.message,e.errors,t);return s}}export{R as A};
