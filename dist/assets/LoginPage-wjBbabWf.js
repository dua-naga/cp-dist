import{d as R,q as te,v as J,g as P,c as T,x as Y,a as h,k as S,y as oe,h as i,z as se,f as K,u as H,s as Q,j as q,A as ae,i as X,B as ie,C as ne,b as d,e as c,w as p,l as E,t as b,F as re,m as le,n as $,r as ce,p as G}from"./index-BuIkzTbX.js";import{h as ue,z as A,s as de,a as M}from"./external-BHKkdwsu.js";import{A as O}from"./Auth-BewR9uMd.js";import{_ as pe}from"./AppLogo.vue_vue_type_script_setup_true_lang-Co3iiMYR.js";import{u as Z}from"./cart-Cpwgim7R.js";import{u as me}from"./title-DTf3XjVI.js";import{s as B}from"./index-CMhtJUBl.js";import{s as W,a as D}from"./index-C9JuvMH3.js";import{s as fe}from"./index-CgPAqISb.js";import{s as ge}from"./index-Dfosv_H0.js";import"./Api-D_vvPt4a.js";import"./index-FvBsrFbw.js";var L={library:"https://accounts.google.com/gsi/client",defaultButtonConfig:{theme:"outline",size:"large"},scopes:"email profile openid",ssrError:"vue3-google-login cannot be executed on the server side. See here for more info https://devbaji.github.io/vue3-google-login/#no-ssr-support"};const I=J({clientId:null,popupType:"CODE",prompt:!1,autoLogin:!1,idConfiguration:null,buttonConfig:L.defaultButtonConfig,callback:()=>{},error:null}),C=J({apiLoaded:!1,apiLoadIntitited:!1}),ve=e=>{try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(t).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)}catch{throw"JWT provided is invalid"}},he=()=>new Promise((e,t)=>{if(typeof window<"u"){if(!C.apiLoadIntitited){const a=document.createElement("script");C.apiLoadIntitited=!0,a.addEventListener("load",()=>{C.apiLoaded=!0,e(window.google)}),a.addEventListener("error",()=>{t("Failed to load the Google 3P Authorization JavaScript Library.")}),a.src=L.library,a.async=!0,a.defer=!0,document.head.appendChild(a)}}else t(L.ssrError)}),V=e=>{C.apiLoadIntitited?C.apiLoaded?e(window.google):se(()=>C.apiLoaded,t=>{t&&e(window.google)}):he().then(t=>{e(t)})},_e=(e,t,a,s)=>{if(!e.client_id)throw new Error("Prop client id required since plugin is not initialized with a client id");V(()=>{((o,y,r,l,m)=>{if(m){const v=o.callback;o.callback=f=>{f.credential?v&&v(f):m(f)}}window.google.accounts.id.initialize(o);const n=y.value;n&&!l&&window.google.accounts.id.renderButton(n,r)})(e,t,a.buttonConfig,s,a.error),a.prompt&&ye({clientId:a.clientId,callback:a.callback,error:a.error,autoLogin:a.autoLogin})})},we=e=>new Promise((t,a)=>{V(s=>{if(!(e&&e.clientId||I.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");s.accounts.oauth2.initCodeClient({client_id:e&&e.clientId||I.clientId||"",scope:L.scopes,ux_mode:"popup",callback:o=>{o.code?t(o):a(o)},error_callback:o=>{a(o)}}).requestCode()})}),be=e=>new Promise((t,a)=>{V(s=>{if(!(e&&e.clientId||I.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");s.accounts.oauth2.initTokenClient({client_id:e&&e.clientId||I.clientId||"",scope:L.scopes,callback:o=>{o.access_token?t(o):a(o)},error_callback:o=>{a(o)}}).requestAccessToken()})}),ye=e=>{if(!e&&(e={}),!e.clientId&&!I.clientId)throw new Error("clientId is required");const t={use_fedcm_for_prompt:!0};return e.clientId&&(t.client_id=e.clientId),!e.clientId&&I.clientId&&(t.client_id=I.clientId),e.context&&(t.context=e.context),e.autoLogin!=null&&(t.auto_select=e.autoLogin),e.cancelOnTapOutside!=null&&(t.cancel_on_tap_outside=e.cancelOnTapOutside),new Promise((a,s)=>{t.callback=o=>{e&&e.callback&&e.callback(o),o.credential?a(o):s(o)},V(o=>{o.accounts.id.initialize(t),o.accounts.id.prompt()})})};var N=R({__name:"GoogleLogin",props:{clientId:{type:String,required:!1},prompt:{type:Boolean,required:!1,default:!1},autoLogin:{type:Boolean,required:!1,default:!1},popupType:{type:String,required:!1},idConfiguration:{type:Object,required:!1},buttonConfig:{type:Object,required:!1},callback:{type:Function,required:!1},error:{type:Function,required:!1}},setup(e){if(!(typeof window<"u"))throw new Error(L.ssrError);const t=!!te().default,a=e,s=((r,l)=>{const m={...r};for(const n in l)l[n]!==void 0&&l[n]!==null&&(m[n]=l[n]);return m})(I,a),o={client_id:s.clientId||null,auto_select:s.autoLogin||!1,callback:s.callback,...s.idConfiguration},y=P();return Y(()=>{_e(o,y,s,t),a.popupType&&!t&&console.warn("Option 'popupType' is ignored since a slot which act as a custom login button was not found!!!")}),(r,l)=>(h(),T("div",{class:"g-btn-wrapper",onClick:l[0]||(l[0]=m=>i(t)&&void(i(s).popupType==="TOKEN"?be({clientId:s.clientId}).then(n=>{s.callback&&s.callback(n)}).catch(n=>{s.error&&s.error(n)}):we({clientId:s.clientId}).then(n=>{s.callback&&s.callback(n)}).catch(n=>{s.error&&s.error(n)})))},[i(t)?S("v-if",!0):(h(),T("span",{key:0,ref_key:"buttonRef",ref:y,class:"g-btn"},null,512)),oe(r.$slots,"default")]))}});(function(e,t){t===void 0&&(t={});var a=t.insertAt;if(typeof document<"u"){var s=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",a==="top"&&s.firstChild?s.insertBefore(o,s.firstChild):s.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}})(`
.g-btn-wrapper[data-v-5e610566] {
  display: inline-block;
}
`),N.__scopeId="data-v-5e610566",N.__file="src/plugin/GoogleLogin.vue";const ke=R({__name:"LoginWithGoogle",setup(e){const t=X(),{t:a}=K(),{googleClientId:s}=ae(),o=H(),y=Z(),{loginError:r}=Q(o),l=n=>{const v=ve(n.credential);m(v)},m=async n=>{var v;if(!n.email_verified){r.value="Can't Sign in. Your google account must be verified";return}try{const f=await O.googleLogin({name:n.name,email:n.email,google_id:n.sub});if(!((v=f.user.roles)!=null&&v.map(_=>_.name).includes("customer")))throw new Error(a("invalid_credentials"));o.authenticate({token:f.token,user:f.user});const x=await O.me({includes:"customer"});r.value=null,o.user=x,y.setUserId(x.id.toString()),t.push({name:"auth.redirect"})}catch(f){const x=f;r.value=x.message}};return(n,v)=>(h(),q(i(N),{callback:l,"client-id":i(s)},null,8,["client-id"]))}}),Ie={class:"min-h-dvh overflow-y-auto bg-white p-8 md:p-12 lg:p-24"},xe={class:"flex h-full flex-col items-center justify-between gap-16"},Ce={class:"flex flex-col gap-1"},Le={for:"email"},Ee={class:"space-y-0"},Se={class:"flex flex-col gap-1"},qe={for:"password"},Te={class:"my-0 flex list-disc flex-col gap-1 px-4"},ze={class:"text-end"},Be={class:"flex flex-col space-y-2"},Pe={class:"text-center"},De=R({__name:"LoginPage",setup(e){const{t}=K();me(t("login"));const a=ne(),s=X(),o=H(),y=Z(),r=P({username:"",password:""}),{loginError:l}=Q(o),m=P(!1),n=P(null),v=ue(A.object({username:A.string(),password:A.string().min(3,{message:"Minimum 8 characters."}).refine(_=>/[a-z]/.test(_),{message:"Must have a lowercase letter."})})),f=ie(()=>a.query.reset);Y(()=>{var _;(_=f.value)!=null&&_.length&&(n.value="Reset Password success. Please login with your new password",r.value.username=f.value)});const x=async _=>{var u;if(_.valid){m.value=!0;try{const k=await O.authenticate(r.value);if(!((u=k.user.roles)!=null&&u.map(z=>z.name).includes("customer")))throw new Error(t("invalid_credentials"));o.authenticate({token:k.token,user:k.user});const w=await O.me({includes:"customer"});l.value=null,o.user=w,y.setUserId(w.id.toString()),s.push({name:"auth.redirect"})}catch(k){const w=k;l.value=w.message}finally{m.value=!1}}};return(_,u)=>{const k=ce("RouterLink");return h(),T("div",Ie,[d("div",xe,[c(pe),c(i(de),{"initial-values":r.value,resolver:i(v),class:"mx-auto flex w-full max-w-md flex-col gap-4",onSubmit:x},{default:p(w=>{var z,j,F,U;return[u[4]||(u[4]=d("div",{class:"space-y-2"},[d("div",{class:"text-center text-2xl font-bold"},"Welcome"),d("div",{class:"text-center text-sm text-slate-600"}," Welcome Back, Please enter Your details ")],-1)),(z=n.value)!=null&&z.length?(h(),q(i(B),{key:0,severity:"success",icon:"pi pi-check-circle",closable:"",onClose:u[0]||(u[0]=g=>n.value=null)},{default:p(()=>[E(b(n.value),1)]),_:1})):S("",!0),(j=i(l))!=null&&j.length?(h(),q(i(B),{key:1,severity:"error",icon:"pi pi-times-circle",closable:"",onClose:u[1]||(u[1]=g=>l.value=null)},{default:p(()=>[E(b(i(l)),1)]),_:1})):S("",!0),d("div",Ce,[c(i(M),{variant:"in"},{default:p(()=>[c(i(W),null,{default:p(()=>[c(i(D),{class:"pi pi-at"}),c(i(fe),{id:"email",modelValue:r.value.username,"onUpdate:modelValue":u[2]||(u[2]=g=>r.value.username=g),name:"email",fluid:""},null,8,["modelValue"])]),_:1}),d("label",Le,b(i(t)("email")),1)]),_:1}),(F=w.username)!=null&&F.invalid?(h(),q(i(B),{key:0,severity:"error",size:"small",variant:"simple"},{default:p(()=>[E(b(w.username.error.message),1)]),_:2},1024)):S("",!0)]),d("div",Ee,[d("div",Se,[c(i(M),{variant:"in"},{default:p(()=>[c(i(W),null,{default:p(()=>[c(i(D),{class:"pi pi-unlock"}),c(i(ge),{id:"password",modelValue:r.value.password,"onUpdate:modelValue":u[3]||(u[3]=g=>r.value.password=g),type:"text",name:"password",feedback:!1,"toggle-mask":"",fluid:""},null,8,["modelValue"])]),_:1}),d("label",qe,b(i(t)("password")),1)]),_:1}),(U=w.password)!=null&&U.invalid?(h(),q(i(B),{key:0,severity:"error",size:"small",variant:"simple"},{default:p(()=>[d("ul",Te,[(h(!0),T(re,null,le(w.password.errors,(g,ee)=>(h(),T("li",{key:ee},b(g.message),1))),128))])]),_:2},1024)):S("",!0)]),d("div",ze,[c(i($),{link:"","as-child":""},{default:p(g=>[c(k,{to:{name:"auth.forgot-password"},class:G([g.class,"hover:underline"])},{default:p(()=>[E(b(i(t)("forgot_password"))+"? ",1)]),_:2},1032,["class"])]),_:1})])]),d("div",Be,[c(i($),{type:"submit",label:i(t)("login"),loading:m.value},null,8,["label","loading"]),c(ke)]),d("div",Pe,[c(i($),{link:"","as-child":""},{default:p(g=>[c(k,{to:{name:"auth.register"},class:G([g.class,"hover:underline"])},{default:p(()=>[E(b(i(t)("do_not_have_an_account"))+"? ",1),d("strong",null,b(i(t)("register")),1)]),_:2},1032,["class"])]),_:1})])]}),_:1,__:[4]},8,["initial-values","resolver"]),u[5]||(u[5]=d("div",{class:"text-sm text-slate-600"}," Lorem ipsum dolor sit, amet consectetur adipisicing elit. Impedit, accusamus blanditiis officiis asperiores optio magnam sed provident eum inventore enim ut odio unde a ipsam aliquid porro, facere et totam! ",-1))])])}}});export{De as default};
