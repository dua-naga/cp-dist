var D=Object.defineProperty;var M=(i,t,s)=>t in i?D(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var q=(i,t,s)=>M(i,typeof t!="symbol"?t+"":t,s);import{d as A,f as R,u as G,s as O,ae as j,j as I,h as e,n as S,i as H,a as f,c as $,e as b,aj as J,w as p,b as o,aE as K,l as z,F as Q,m as W,t as V,k as X}from"./index-CvL64b5B.js";import{A as Y}from"./Api-0keYiYT7.js";import{u as Z}from"./app-toast-C0ygo0ES.js";import{u as T}from"./cart-D-k1wTQd.js";import{u as ee}from"./title-D2a3ovK7.js";import{s as te}from"./index-CxuldK3J.js";import{s as se}from"./index-Dg0_AxQJ.js";import{s as E}from"./index-DAbN7U77.js";import{s as ae}from"./index-Bbx7aRwr.js";import"./index-qByAEdWs.js";class re extends Y{constructor(){super(...arguments);q(this,"resource","customer-orders")}async placeOrder(s={}){var d;const{data:_,error:x,response:u}=await this.fetch(`${this.resource}/place-order`).post(s).json();return this.handleResponse(_.value,x.value,(d=u.value)==null?void 0:d.status)}}const oe=new re,le=A({__name:"PlaceOrderButton",setup(i){const t=H(),{t:s}=R(),{toastSuccess:_,toastError:x}=Z(),u=G(),d=T(),{user:k}=O(u),{cart:w,totalItems:a,externalNumber:l,placingOrder:y}=O(d),U=j(()=>{var r;return(r=k.value.companies)==null?void 0:r[0].id}),F=j(()=>{var r;return(r=k.value.customer)==null?void 0:r.id}),L=j(()=>{const r=w.value.filter(n=>n.cartable_type==="product").reduce((n,h)=>{var g,C;const m=h.cartable,c=(C=(g=m==null?void 0:m.product)==null?void 0:g.brand)==null?void 0:C.id;return c&&(n[c]||(n[c]=[]),n[c].push(h)),n},{});return Object.entries(r).map(([n,h])=>{var g,C;const m=(g=h[0])==null?void 0:g.cartable,c=(C=m==null?void 0:m.product)==null?void 0:C.brand;return{brand_id:Number(n),company_id:c==null?void 0:c.company_id,customer_id:c==null?void 0:c.customer_id,subtotal:0,tax:0,tax_base:0,tax_percentage:0,total:0,items:h.map(B=>{var N;const v=B.cartable;return{product_id:(N=v==null?void 0:v.product)==null?void 0:N.id,variant_id:v==null?void 0:v.id,quantity:B.qty,price:0,tax_base:0,total:0}})}})}),P=async()=>{y.value=!0;try{const{message:r}=await oe.placeOrder({company_id:U.value,customer_id:F.value,external_number:l.value,source:"customer_portal",sales_orders:L.value});l.value=null,d.clearCart(),_(r),t.push({name:"my-orders"})}catch(r){x(r.message)}finally{y.value=!1}};return(r,n)=>(f(),I(e(S),{type:"button",class:"w-full sm:w-auto",label:`${e(s)("place_order")} (${e(a)})`,icon:"pi pi-receipt",loading:e(y),onClick:P},null,8,["label","loading"]))}}),ne={class:"mx-auto max-w-5xl"},ce={class:"flex w-full flex-wrap items-center justify-between gap-4"},ie={class:"text-lg font-bold"},ue={key:0,class:"border-surface-200 flex-1 space-y-4 overflow-y-auto border-y py-4"},de={class:"divide-surface-200 flex flex-col divide-y"},me={class:"flex w-full flex-1 flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},pe={class:"text-sm font-medium sm:text-base"},fe={class:"flex items-center justify-end gap-2"},_e={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},xe={class:"flex flex-col gap-2"},Oe=A({__name:"MyCartPage",setup(i){const{t}=R();ee(t("my_cart"));const s=T(),{cart:_,totalItems:x,externalNumber:u}=O(s),d=w=>{s.removeItem(w.cartable_id,w.cartable_type)},k=()=>{s.clearCart()};return(w,a)=>(f(),$("div",ne,[b(e(te),{"pt:root:class":"flex flex-col h-full justify-between","pt:content-container:class":"flex flex-col flex-1","pt:content:class":"flex-1"},J({header:p(()=>[o("div",ce,[o("div",ie,V(e(t)("my_cart")),1),e(x)>1?(f(),I(e(S),{key:0,label:e(t)("clear"),icon:"pi pi-trash",severity:"secondary",size:"small",onClick:k},null,8,["label"])):X("",!0)])]),default:p(()=>[e(_).length?(f(),$("div",ue,[o("div",de,[(f(!0),$(Q,null,W(e(_),l=>(f(),$("div",{key:`${l.cartable_type}-${l.cartable_id}`,class:"flex flex-col items-start justify-between gap-3 p-2 sm:flex-row sm:items-center"},[a[3]||(a[3]=o("div",{class:"bg-surface-200 flex aspect-square w-full max-w-[56px] items-center justify-center self-start overflow-hidden rounded sm:max-w-[72px]"},[o("i",{class:"pi pi-image text-4xl"})],-1)),o("div",me,[o("div",pe,V(l.name),1),o("div",fe,[b(e(S),{icon:"pi pi-trash",variant:"text",severity:"danger",size:"small",onClick:y=>d(l)},null,8,["onClick"]),b(e(ae),{modelValue:l.qty,"onUpdate:modelValue":y=>l.qty=y,"input-class":"cart-item-qty-input","show-buttons":"","button-layout":"horizontal",size:"small",locale:"id",min:1},{incrementicon:p(()=>a[1]||(a[1]=[o("span",{class:"pi pi-plus"},null,-1)])),decrementicon:p(()=>a[2]||(a[2]=[o("span",{class:"pi pi-minus"},null,-1)])),_:2},1032,["modelValue","onUpdate:modelValue"])])])]))),128))])])):(f(),I(e(E),{key:1,severity:"warn"},{default:p(()=>[z(V(e(t)("cart_is_empty")),1)]),_:1}))]),_:2},[e(x)>0?{name:"footer",fn:p(()=>[o("div",_e,[o("div",xe,[b(e(se),{modelValue:e(u),"onUpdate:modelValue":a[0]||(a[0]=l=>K(u)?u.value=l:null),placeholder:e(t)("customer_order_external_number"),class:"w-full md:max-w-md"},null,8,["modelValue","placeholder"]),b(e(E),{size:"small",severity:"secondary",variant:"simple",icon:"pi pi-info-circle"},{default:p(()=>a[4]||(a[4]=[z(" Lorem ipsum dolot sit amet ")])),_:1,__:[4]})]),b(le)])]),key:"0"}:void 0]),1024)]))}});export{Oe as default};
