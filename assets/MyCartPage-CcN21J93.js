var P=Object.defineProperty;var D=(i,t,a)=>t in i?P(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a;var q=(i,t,a)=>D(i,typeof t!="symbol"?t+"":t,a);import{d as T,f as A,ae as M,u as G,s as O,af as j,j as I,h as e,n as B,i as H,a as _,c as C,e as v,ak as J,w as f,b as l,aF as K,l as z,F as Q,m as W,t as V,k as X}from"./index-ChONLvXT.js";import{A as Y}from"./Api-CpiGTlUC.js";import{u as F}from"./cart-n70GHfAL.js";import{u as Z}from"./title-B0mAHwLg.js";import{s as ee}from"./index-B0G3N2AP.js";import{s as te}from"./index-DNrJJ1ap.js";import{s as R}from"./index-Cb3a1vIw.js";import{s as se}from"./index-DhtKmfrD.js";import"./index-BJOeZ_q3.js";class ae extends Y{constructor(){super(...arguments);q(this,"resource","customer-orders")}async placeOrder(a={}){var m;const{data:d,error:x,response:u}=await this.fetch(`${this.resource}/place-order`).post(a).json();return this.handleResponse(d.value,x.value,(m=u.value)==null?void 0:m.status)}}const re=new ae,oe=T({__name:"PlaceOrderButton",setup(i){const t=H(),{t:a}=A(),d=M(),x=G(),u=F(),{user:m}=O(x),{cart:$,totalItems:b,externalNumber:s,placingOrder:n}=O(u),k=j(()=>{var r;return(r=m.value.companies)==null?void 0:r[0].id}),U=j(()=>{var r;return(r=m.value.customer)==null?void 0:r.id}),E=j(()=>{const r=$.value.filter(o=>o.cartable_type==="product").reduce((o,w)=>{var h,g;const p=w.cartable,c=(g=(h=p==null?void 0:p.product)==null?void 0:h.brand)==null?void 0:g.id;return c&&(o[c]||(o[c]=[]),o[c].push(w)),o},{});return Object.entries(r).map(([o,w])=>{var h,g;const p=(h=w[0])==null?void 0:h.cartable,c=(g=p==null?void 0:p.product)==null?void 0:g.brand;return{brand_id:Number(o),company_id:c==null?void 0:c.company_id,customer_id:c==null?void 0:c.customer_id,subtotal:0,tax:0,tax_base:0,tax_percentage:0,total:0,items:w.map(N=>{var S;const y=N.cartable;return{product_id:(S=y==null?void 0:y.product)==null?void 0:S.id,variant_id:y==null?void 0:y.id,quantity:N.qty,price:0,tax_base:0,total:0}})}})}),L=async()=>{n.value=!0;try{const{message:r}=await re.placeOrder({company_id:k.value,customer_id:U.value,external_number:s.value,source:"customer",sales_orders:E.value});s.value=null,u.clearCart(),d.add({severity:"success",summary:r}),t.push({name:"my-orders"})}catch(r){const o=r;d.add({severity:"error",summary:o.message})}finally{n.value=!1}};return(r,o)=>(_(),I(e(B),{type:"button",class:"w-full sm:w-auto",label:`${e(a)("place_order")} (${e(b)})`,icon:"pi pi-receipt",onClick:L},null,8,["label"]))}}),le={class:"mx-auto max-w-5xl"},ne={class:"flex w-full flex-wrap items-center justify-between gap-4"},ce={class:"text-lg font-bold"},ie={key:0,class:"border-surface-200 flex-1 space-y-4 overflow-y-auto border-y py-4"},ue={class:"divide-surface-200 flex flex-col divide-y"},de={class:"flex w-full flex-1 flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},me={class:"text-sm font-medium sm:text-base"},pe={class:"flex items-center justify-end gap-2"},fe={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},_e={class:"flex flex-col gap-2"},je=T({__name:"MyCartPage",setup(i){const{t}=A();Z(t("my_cart"));const a=F(),{cart:d,totalItems:x,externalNumber:u}=O(a),m=b=>{a.removeItem(b.cartable_id,b.cartable_type)},$=()=>{a.clearCart()};return(b,s)=>(_(),C("div",le,[v(e(ee),{"pt:root:class":"flex flex-col h-full justify-between","pt:content-container:class":"flex flex-col flex-1","pt:content:class":"flex-1"},J({header:f(()=>[l("div",ne,[l("div",ce,V(e(t)("my_cart")),1),e(x)>1?(_(),I(e(B),{key:0,label:e(t)("clear"),icon:"pi pi-trash",severity:"secondary",size:"small",onClick:$},null,8,["label"])):X("",!0)])]),default:f(()=>[e(d).length?(_(),C("div",ie,[l("div",ue,[(_(!0),C(Q,null,W(e(d),n=>(_(),C("div",{key:`${n.cartable_type}-${n.cartable_id}`,class:"flex flex-col items-start justify-between gap-3 p-2 sm:flex-row sm:items-center"},[s[3]||(s[3]=l("div",{class:"bg-surface-200 flex aspect-square w-full max-w-[56px] items-center justify-center self-start overflow-hidden rounded sm:max-w-[72px]"},[l("i",{class:"pi pi-image text-4xl"})],-1)),l("div",de,[l("div",me,V(n.name),1),l("div",pe,[v(e(B),{icon:"pi pi-trash",variant:"text",severity:"danger",size:"small",onClick:k=>m(n)},null,8,["onClick"]),v(e(se),{modelValue:n.qty,"onUpdate:modelValue":k=>n.qty=k,"input-class":"cart-item-qty-input","show-buttons":"","button-layout":"horizontal",size:"small",locale:"id",min:1},{incrementicon:f(()=>s[1]||(s[1]=[l("span",{class:"pi pi-plus"},null,-1)])),decrementicon:f(()=>s[2]||(s[2]=[l("span",{class:"pi pi-minus"},null,-1)])),_:2},1032,["modelValue","onUpdate:modelValue"])])])]))),128))])])):(_(),I(e(R),{key:1,severity:"warn"},{default:f(()=>[z(V(e(t)("cart_is_empty")),1)]),_:1}))]),_:2},[e(x)>0?{name:"footer",fn:f(()=>[l("div",fe,[l("div",_e,[v(e(te),{modelValue:e(u),"onUpdate:modelValue":s[0]||(s[0]=n=>K(u)?u.value=n:null),placeholder:e(t)("customer_order_external_number"),class:"w-full md:max-w-md"},null,8,["modelValue","placeholder"]),v(e(R),{size:"small",severity:"secondary",variant:"simple",icon:"pi pi-info-circle"},{default:f(()=>s[4]||(s[4]=[z(" Lorem ipsum dolot sit amet ")])),_:1,__:[4]})]),v(oe)])]),key:"0"}:void 0]),1024)]))}});export{je as default};
